<html xmlns:th="http://www.thymeleaf.org">

<body>
	<div th:replace="~{include/top}"></div>
	<div th:replace="~{member/address/address}"></div>

	<section>
	
		<div align="center">
			<h2>회원가입하기</h2>
		</div>
		<div align="center">

			<form name=frm method="POST" action="/member/memberOK">
				<table border="1">
						<tr>
							<th width=150>아이디</th>
							<td>
								<input type=text id=username name=username size=20 /> 
								<input type="button" id="CKlog" value="중복 확인" /></td>
						</tr>
						<tr>
							<th>암 호</th>
							<td><input type=text name=password size=55 /></td>
						</tr>
						<tr>
							<th>전화번호</th>
							<td><input type=text name=phone size=55 /></td>
						</tr>
						<tr>
							<th>회원주소</th>
							<td align="left"><span id="guide" style="color: #999; display: none"></span> 
								<input type="text"id="sample4_postcode" placeholder="우편번호" name=addr1 size=20>
								<input type="button" onclick="sample4_execDaumPostcode()" value="우편번호 찾기"> 
								<input type="text" id="sample4_roadAddress" placeholder="주소" name=addr2 size=55><br>
								<input type="text" id="sample4_detailAddress" placeholder="상세주소" name=addr3 size=55>
							</td>
						</tr>
						<tr>
							<th>이 름</th>
							<td><input type=text name=name size=55 /></td>
						</tr>
						<tr>
							<th>나 이</th>
							<td><input type=text name=age size=55 /></td>
						</tr>
						<tr>
							<th>성 별</th>
							<td class="left-align">
								<input type="radio" name="gender" value="M"> <label for="male">남성</label> 
								<input type="radio" name="gender" value="F"> <label for="female">여성</label>
							</td>
						</tr>
						<tr>
							<th>등 급</th>
							<td><input type=text name=role size=55 /></td>
						</tr>
						<tr>
							<td colspan=2 align="center"><input type=submit value="저장하기" />&emsp;
								<input type=reset value="다시작성" /></td>
						</tr>

					</table>
			</form>

		</div>
	</section>
	
	<script th:inline="javascript">
		jQuery.ajaxSetup({
			cache : false
		});

		function kg_request_pay() {
			//전달할 데이터 4가지는 필수 값
			// data-name(상품이름): 3개월무료사용 , data-price(가격): 100  , data-goodsnum(주문번호) : "70001" 
			var selectedDate = document.getElementById("datepicker").value;
			var selectedGoodsName = document.querySelector(".kg_pay_btn")
					.getAttribute("data-name");
			var selectedGoodsPrice = document.querySelector(".kg_pay_btn")
					.getAttribute("data-price");
			var selectedGoodsNum = document.querySelector(".kg_pay_btn")
					.getAttribute("data-goodsnum");

			//kg이니시스 결제 API
			var IMP = window.IMP; // 생략가능
			IMP.init('imp33165546'); // 가맹점 식별코드

			// IMP.request_pay(param, callback) 결제창 호출
			IMP.request_pay({
				pg : "html5_inicis",
				pay_method : "card",
				merchant_uid : "gpay_" + new Date().getTime(), // 주문번호
				name : "마주스토리" + " " + selectedGoodsName, // 상품이름
				amount : selectedGoodsPrice, // 상품가격 (숫자 타입)
				buyer_email : "6963jj@naver.com",
				buyer_name : "jang hyeon seo",
				buyer_tel : "01038516963"
			}, function(rsp) { // callback
				console.log(rsp);
				if (rsp.success) { //결제 성공시
					var msg = '결제가 완료되었습니다.';
					var result = {
						"mpaynum" : rsp.merchant_uid, //결제번호
						"membernum" : "AA00001", //회원번호
						"mpaymethod" : rsp.pay_method, //결제수단
						"mpayproduct" : rsp.name, //헬스장 이름 + 상품이름
						"mpayprice" : rsp.paid_amount, // 결제금액
						"mpaydate" : new Date().toISOString().slice(0, 10), //결제일
						"mpaygym" : "마주스토리", //헬스장 이름
						"mpayperiod" : selectedDate, //상품이용기간
						"mpaytime" : "",
						"trainername" : "",
						"ggoodsnum" : selectedGoodsNum, //상품번호
						"tgoodsint" : null,
						"gymnum" : "B0001" //헬스장 고유번호
					}
					console.log(result);

					$.ajax({
						url : '/PortOneT/insertMPay',
						type : 'POST',
						contentType : 'application/json',
						data : JSON.stringify(result),
						success : function(res) {
							console.log(res);
							location.href = res;
						},
						error : function(err) {
							console.log(err);
						}
					}); //ajax
				} else {
					var msg = '결제 실패';
					msg += '\n에러내용 : ' + rsp.error_msg;
				}
				alert(msg);
			});
		}
	</script>


	<div th:replace="~{include/bottom::footer}"></div>
</body>
</html>